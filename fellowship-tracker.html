<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Fellowship Roadmap Tracker - Enhanced</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='80' font-size='80'%3EüéØ%3C/text%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Philosopher:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Philosopher', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #00838F 0%, #006064 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #00838F 0%, #006064 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 3px solid #667eea;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #666;
            font-size: 0.85em;
        }

        .stat-card.behind h3 {
            color: #f44336;
        }

        .stat-card.ahead h3 {
            color: #4CAF50;
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .nav-btn:hover, .nav-btn.active {
            background: #667eea;
            color: white;
        }

        .content {
            padding: 20px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .checklist-phase {
            margin-bottom: 20px;
            border: 2px solid #667eea;
            border-radius: 10px;
            overflow: hidden;
        }

        .checklist-header {
            background: #667eea;
            color: white;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .checklist-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .checklist-content.expanded {
            max-height: 5000px;
        }

        .month-section {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .month-title {
            font-size: 1.1em;
            color: #667eea;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid transparent;
            transition: all 0.2s;
        }

        .checklist-item.completed {
            background: #e8f5e9;
            border-left-color: #4CAF50;
        }

        .checklist-item.overdue {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .checklist-item input[type="checkbox"] {
            margin-right: 10px;
            margin-top: 3px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .task-content {
            flex: 1;
        }

        .task-dates {
            display: flex;
            gap: 10px;
            margin-top: 5px;
            font-size: 0.85em;
        }

        .date-badge {
            padding: 3px 8px;
            border-radius: 3px;
            background: #e3f2fd;
            color: #1976d2;
        }

        .date-badge.completed {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .date-badge.overdue {
            background: #ffebee;
            color: #c62828;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .timeline-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .timeline-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .timeline-date {
            min-width: 100px;
            font-weight: bold;
            color: #667eea;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .export-btn {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .export-btn:hover {
            background: #45a049;
        }

        .calendar-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .calendar-month {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .calendar-month h3 {
            color: #667eea;
            margin-bottom: 10px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .calendar-tasks {
            font-size: 0.9em;
        }

        .calendar-task {
            padding: 5px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 3px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .variance-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .variance-indicator.early {
            background: #4CAF50;
            color: white;
        }

        .variance-indicator.late {
            background: #f44336;
            color: white;
        }

        .variance-indicator.ontime {
            background: #2196F3;
            color: white;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5em;
            }
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            .nav-btn {
                padding: 8px 15px;
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Fellowship Roadmap Tracker Pro</h1>
            <p>Dr. Yaaqoob Alhammadi - Enhanced Progress Tracking</p>
            <p id="currentDate"></p>
        </header>

        <div class="stats-bar">
            <div class="stat-card">
                <h3 id="completedTasks">0/250+</h3>
                <p>Tasks Completed</p>
            </div>
            <div class="stat-card">
                <h3 id="progressPercent">0%</h3>
                <p>Overall Progress</p>
            </div>
            <div class="stat-card">
                <h3 id="daysElapsed">0</h3>
                <p>Days Elapsed</p>
            </div>
            <div class="stat-card" id="varianceCard">
                <h3 id="scheduleVariance">On Track</h3>
                <p>Schedule Status</p>
            </div>
            <div class="stat-card">
                <h3 id="currentPhase">Phase 1</h3>
                <p>Current Phase</p>
            </div>
            <div class="stat-card">
                <h3 id="upcomingTasks">0</h3>
                <p>Due This Month</p>
            </div>
        </div>

        <nav>
            <button class="nav-btn active" onclick="showSection('dashboard')">üìä Dashboard</button>
            <button class="nav-btn" onclick="showSection('checklist')">‚úÖ Checklist</button>
            <button class="nav-btn" onclick="showSection('analytics')">üìà Analytics</button>
            <button class="nav-btn" onclick="showSection('calendar')">üìÖ Calendar</button>
            <button class="nav-btn" onclick="showSection('timeline')">‚è±Ô∏è Timeline</button>
            <button class="export-btn" onclick="exportProgress()">üì• Export</button>
        </nav>

        <div class="content">
            <!-- DASHBOARD -->
            <div id="dashboard" class="section active">
                <h2>Progress Dashboard</h2>
                
                <div class="chart-container">
                    <h3>Overall Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="overallProgress">0%</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Plan vs Actual Progress</h3>
                    <canvas id="planActualChart" width="400" height="200"></canvas>
                </div>

                <div class="analytics-grid">
                    <div class="chart-container">
                        <h3>Phase Completion</h3>
                        <div id="phaseProgress"></div>
                    </div>
                    <div class="chart-container">
                        <h3>Recent Completions</h3>
                        <div id="recentCompletions"></div>
                    </div>
                </div>
            </div>

            <!-- CHECKLIST -->
            <div id="checklist" class="section">
                <h2>Interactive Checklist with Date Tracking</h2>
                <div id="checklistContainer"></div>
            </div>

            <!-- ANALYTICS -->
            <div id="analytics" class="section">
                <h2>Detailed Analytics</h2>
                <div id="analyticsContent"></div>
            </div>

            <!-- CALENDAR -->
            <div id="calendar" class="section">
                <h2>Calendar View</h2>
                <div class="calendar-view" id="calendarView"></div>
            </div>

            <!-- TIMELINE -->
            <div id="timeline" class="section">
                <h2>Timeline & Milestones</h2>
                <div class="timeline-container" id="timelineContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // Start date: November 11, 2025
        const START_DATE = new Date('2025-11-11');
        
        // Enhanced data structure with dates
        const roadmapData = {
            phases: [
                {
                    name: "Phase 1: USMLE Step 1",
                    start: 1,
                    duration: 7,
                    startDate: new Date('2025-11-11'),
                    endDate: new Date('2026-05-31'),
                    color: "#4CAF50",
                    months: [
                        {
                            month: "Month 1 (Nov 2025)",
                            startDate: new Date('2025-11-11'),
                            tasks: [
                                { text: "Email ACGME-I to verify Tawam accreditation", dueDate: new Date('2025-11-11') },
                                { text: "Create ECFMG account (OASIS)", dueDate: new Date('2025-11-12') },
                                { text: "Link EPIC to ECFMG", dueDate: new Date('2025-11-13') },
                                { text: "Purchase USMLE Step 1 materials ($608)", dueDate: new Date('2025-11-14') },
                                { text: "Take NBME baseline assessment", dueDate: new Date('2025-11-15') },
                                { text: "Create 6-month study schedule", dueDate: new Date('2025-11-16') }
                            ]
                        },
                        {
                            month: "Months 2-3 (Dec 2025-Jan 2026)",
                            startDate: new Date('2025-12-01'),
                            tasks: [
                                { text: "Study 3 hours daily weekdays", dueDate: new Date('2026-01-31') },
                                { text: "Complete cardiovascular system", dueDate: new Date('2025-12-07') },
                                { text: "Complete respiratory system", dueDate: new Date('2025-12-14') },
                                { text: "Complete renal system", dueDate: new Date('2025-12-21') },
                                { text: "Complete GI system", dueDate: new Date('2025-12-28') },
                                { text: "Complete endocrine system", dueDate: new Date('2026-01-15') },
                                { text: "Take NBME Practice Exam 25", dueDate: new Date('2026-01-31') }
                            ]
                        },
                        {
                            month: "Months 4-5 (Feb-Mar 2026)",
                            startDate: new Date('2026-02-01'),
                            tasks: [
                                { text: "Complete hematology/oncology", dueDate: new Date('2026-02-07') },
                                { text: "Complete neurology", dueDate: new Date('2026-02-14') },
                                { text: "Complete psychiatry", dueDate: new Date('2026-02-21') },
                                { text: "Complete microbiology", dueDate: new Date('2026-02-28') },
                                { text: "Take NBME Practice Exam 26", dueDate: new Date('2026-02-28') },
                                { text: "Complete immunology", dueDate: new Date('2026-03-07') },
                                { text: "Register for USMLE Step 1", dueDate: new Date('2026-03-15') },
                                { text: "Take NBME Practice Exam 27 (Target: 210+)", dueDate: new Date('2026-03-31') }
                            ]
                        },
                        {
                            month: "Months 6-7 (Apr-May 2026)",
                            startDate: new Date('2026-04-01'),
                            tasks: [
                                { text: "Final review: 40-50 hours weekly", dueDate: new Date('2026-05-15') },
                                { text: "Second pass UWorld questions", dueDate: new Date('2026-04-15') },
                                { text: "Take NBME 28 and 29", dueDate: new Date('2026-04-25') },
                                { text: "Take UWSA 1 & 2", dueDate: new Date('2026-05-01') },
                                { text: "USMLE Step 1 Exam (Target: 220+)", dueDate: new Date('2026-05-25') },
                                { text: "Begin fellowship program research", dueDate: new Date('2026-05-31') }
                            ]
                        }
                    ]
                },
                {
                    name: "Phase 2: USMLE Step 2 CK",
                    start: 8,
                    duration: 5,
                    startDate: new Date('2026-06-01'),
                    endDate: new Date('2026-10-31'),
                    color: "#2196F3",
                    months: [
                        {
                            month: "Month 8 (Jun 2026)",
                            startDate: new Date('2026-06-01'),
                            tasks: [
                                { text: "USMLE Step 1 results released", dueDate: new Date('2026-06-07') },
                                { text: "Purchase Step 2 CK materials", dueDate: new Date('2026-06-10') },
                                { text: "Register for OET Medicine", dueDate: new Date('2026-06-15') },
                                { text: "Create 4-month study plan", dueDate: new Date('2026-06-20') },
                                { text: "Expand fellowship program list to 100", dueDate: new Date('2026-06-30') }
                            ]
                        },
                        {
                            month: "Months 9-11 (Jul-Sep 2026)",
                            startDate: new Date('2026-07-01'),
                            tasks: [
                                { text: "Complete Internal Medicine", dueDate: new Date('2026-07-31') },
                                { text: "Take OET Medicine exam", dueDate: new Date('2026-08-10') },
                                { text: "Complete Surgery and OB/GYN", dueDate: new Date('2026-08-31') },
                                { text: "Complete 100% UWorld Step 2 CK", dueDate: new Date('2026-09-15') },
                                { text: "Take NBME Step 2 CK Forms", dueDate: new Date('2026-09-25') },
                                { text: "Register for Step 2 CK exam", dueDate: new Date('2026-09-30') }
                            ]
                        },
                        {
                            month: "Month 12 (Oct 2026)",
                            startDate: new Date('2026-10-01'),
                            tasks: [
                                { text: "Final Step 2 CK preparation", dueDate: new Date('2026-10-15') },
                                { text: "Take UWSA Step 2 CK", dueDate: new Date('2026-10-18') },
                                { text: "USMLE Step 2 CK Exam (Target: 240+)", dueDate: new Date('2026-10-25') },
                                { text: "Draft personal statement", dueDate: new Date('2026-10-31') }
                            ]
                        }
                    ]
                },
                {
                    name: "Phase 3: ECFMG Certification",
                    start: 13,
                    duration: 3,
                    startDate: new Date('2026-11-01'),
                    endDate: new Date('2027-01-31'),
                    color: "#FF9800",
                    months: [
                        {
                            month: "Month 13 (Nov 2026)",
                            startDate: new Date('2026-11-01'),
                            tasks: [
                                { text: "Step 2 CK results released", dueDate: new Date('2026-11-07') },
                                { text: "Submit ECFMG certification application", dueDate: new Date('2026-11-15') },
                                { text: "Finalize personal statement", dueDate: new Date('2026-11-25') },
                                { text: "Collect letters of recommendation", dueDate: new Date('2026-11-30') }
                            ]
                        },
                        {
                            month: "Month 14 (Dec 2026)",
                            startDate: new Date('2026-12-01'),
                            tasks: [
                                { text: "Receive ECFMG certificate", dueDate: new Date('2026-12-10') },
                                { text: "Prepare all ERAS documents", dueDate: new Date('2026-12-15') },
                                { text: "Email 50 target programs", dueDate: new Date('2026-12-20') },
                                { text: "Professional headshot photo", dueDate: new Date('2026-12-31') }
                            ]
                        },
                        {
                            month: "Month 15 (Jan 2027)",
                            startDate: new Date('2027-01-01'),
                            tasks: [
                                { text: "Finalize program list (50 programs)", dueDate: new Date('2027-01-10') },
                                { text: "Confirm all letters uploaded", dueDate: new Date('2027-01-20') },
                                { text: "Prepare interview responses", dueDate: new Date('2027-01-31') }
                            ]
                        }
                    ]
                },
                {
                    name: "Phase 4: Applications & Interviews",
                    start: 16,
                    duration: 6,
                    startDate: new Date('2027-02-01'),
                    endDate: new Date('2027-07-31'),
                    color: "#9C27B0",
                    months: [
                        {
                            month: "Month 16-17 (Feb-Mar 2027)",
                            startDate: new Date('2027-02-01'),
                            tasks: [
                                { text: "Review all application materials", dueDate: new Date('2027-02-15') },
                                { text: "Submit ERAS applications (50 programs)", dueDate: new Date('2027-03-15') },
                                { text: "Register with NRMP", dueDate: new Date('2027-03-15') },
                                { text: "Monitor interview invitations", dueDate: new Date('2027-03-31') }
                            ]
                        },
                        {
                            month: "Months 18-20 (Apr-Jun 2027)",
                            startDate: new Date('2027-04-01'),
                            tasks: [
                                { text: "Complete fellowship interviews", dueDate: new Date('2027-05-31') },
                                { text: "Send thank-you emails", dueDate: new Date('2027-06-05') },
                                { text: "Create preliminary rank list", dueDate: new Date('2027-06-20') },
                                { text: "Discuss rank list with mentors", dueDate: new Date('2027-06-30') }
                            ]
                        },
                        {
                            month: "Month 21 (Jul 2027)",
                            startDate: new Date('2027-07-01'),
                            tasks: [
                                { text: "Finalize and submit rank list", dueDate: new Date('2027-07-25') }
                            ]
                        }
                    ]
                },
                {
                    name: "Phase 5: Match & Visa",
                    start: 22,
                    duration: 7,
                    startDate: new Date('2027-08-01'),
                    endDate: new Date('2028-02-28'),
                    color: "#F44336",
                    months: [
                        {
                            month: "Month 22 (Aug 2027)",
                            startDate: new Date('2027-08-01'),
                            tasks: [
                                { text: "MATCH DAY - Results released", dueDate: new Date('2027-08-20') },
                                { text: "Contact program director", dueDate: new Date('2027-08-21') },
                                { text: "Begin visa processing", dueDate: new Date('2027-08-25') }
                            ]
                        },
                        {
                            month: "Months 23-26 (Sep-Dec 2027)",
                            startDate: new Date('2027-09-01'),
                            tasks: [
                                { text: "Complete DS-160 visa application", dueDate: new Date('2027-09-30') },
                                { text: "Pay SEVIS fee", dueDate: new Date('2027-10-10') },
                                { text: "Visa interview at US Embassy", dueDate: new Date('2027-11-15') },
                                { text: "Apply for state medical license", dueDate: new Date('2027-11-30') },
                                { text: "Complete onboarding paperwork", dueDate: new Date('2027-12-31') }
                            ]
                        },
                        {
                            month: "Months 27-28 (Jan-Feb 2028)",
                            startDate: new Date('2028-01-01'),
                            tasks: [
                                { text: "Research housing near program", dueDate: new Date('2028-01-31') },
                                { text: "Book flights to USA", dueDate: new Date('2028-02-15') },
                                { text: "Notify Tawam Hospital", dueDate: new Date('2028-02-28') }
                            ]
                        }
                    ]
                },
                {
                    name: "Phase 6: Fellowship",
                    start: 29,
                    duration: 14,
                    startDate: new Date('2028-03-01'),
                    endDate: new Date('2029-06-30'),
                    color: "#00BCD4",
                    months: [
                        {
                            month: "Months 29-30 (Mar-Jun 2028)",
                            startDate: new Date('2028-03-01'),
                            tasks: [
                                { text: "Arrive in USA", dueDate: new Date('2028-06-01') },
                                { text: "Obtain Social Security Number", dueDate: new Date('2028-06-10') },
                                { text: "Complete BLS/ACLS", dueDate: new Date('2028-06-20') },
                                { text: "Attend program orientation", dueDate: new Date('2028-06-28') }
                            ]
                        },
                        {
                            month: "Months 31-42 (Jul 2028-Jun 2029)",
                            startDate: new Date('2028-07-01'),
                            tasks: [
                                { text: "Fellowship START - July 1, 2028", dueDate: new Date('2028-07-01') },
                                { text: "Complete 12-month training", dueDate: new Date('2029-06-30') }
                            ]
                        }
                    ]
                },
                {
                    name: "Phase 7: Return to UAE",
                    start: 43,
                    duration: 1,
                    startDate: new Date('2029-07-01'),
                    endDate: new Date('2029-07-31'),
                    color: "#607D8B",
                    months: [
                        {
                            month: "Month 43 (Jul 2029)",
                            startDate: new Date('2029-07-01'),
                            tasks: [
                                { text: "Fellowship completion", dueDate: new Date('2029-06-30') },
                                { text: "Return to UAE", dueDate: new Date('2029-07-15') },
                                { text: "Submit credentials to DOH", dueDate: new Date('2029-07-20') },
                                { text: "Begin Consultant position", dueDate: new Date('2029-07-31') }
                            ]
                        }
                    ]
                }
            ]
        };

        // Calculate days since start
        function getDaysElapsed() {
            const today = new Date();
            const elapsed = Math.floor((today - START_DATE) / (1000 * 60 * 60 * 24));
            return Math.max(0, elapsed);
        }

        // Calculate expected progress based on date
        function getExpectedProgress() {
            const daysElapsed = getDaysElapsed();
            const totalDays = 30 * 30; // 30 months * 30 days
            return Math.min(100, (daysElapsed / totalDays) * 100);
        }

        // Initialize current date display
        function updateCurrentDate() {
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);
        }

        // Generate checklist with date tracking
        function generateChecklist() {
            const container = document.getElementById('checklistContainer');
            let html = '';
            
            roadmapData.phases.forEach((phase, phaseIdx) => {
                html += `<div class="checklist-phase">`;
                html += `<div class="checklist-header" onclick="togglePhase(${phaseIdx})">
                    <span><strong>${phase.name}</strong></span>
                    <span id="phase-progress-${phaseIdx}">0/${getTotalTasks(phase)} completed</span>
                </div>`;
                html += `<div class="checklist-content" id="phase-content-${phaseIdx}">`;
                
                phase.months.forEach((monthData, monthIdx) => {
                    html += `<div class="month-section">`;
                    html += `<div class="month-title">${monthData.month}</div>`;
                    
                    monthData.tasks.forEach((task, taskIdx) => {
                        const checkId = `check-${phaseIdx}-${monthIdx}-${taskIdx}`;
                        const today = new Date();
                        const isOverdue = task.dueDate < today;
                        const overdueClass = isOverdue ? 'overdue' : '';
                        
                        html += `<div class="checklist-item ${overdueClass}" id="item-${checkId}">
                            <input type="checkbox" id="${checkId}" onchange="updateProgress('${checkId}')">
                            <div class="task-content">
                                <label for="${checkId}">${task.text}</label>
                                <div class="task-dates">
                                    <span class="date-badge">Due: ${task.dueDate.toLocaleDateString()}</span>
                                    <span class="date-badge completed" id="completed-${checkId}" style="display:none;"></span>
                                </div>
                            </div>
                        </div>`;
                    });
                    
                    html += `</div>`;
                });
                
                html += `</div></div>`;
            });
            
            container.innerHTML = html;
            loadProgress();
        }

        function getTotalTasks(phase) {
            return phase.months.reduce((sum, month) => sum + month.tasks.length, 0);
        }

        function togglePhase(phaseIdx) {
            const content = document.getElementById(`phase-content-${phaseIdx}`);
            content.classList.toggle('expanded');
        }

        // Enhanced progress tracking with dates
        function updateProgress(checkId) {
            const checkbox = document.getElementById(checkId);
            const item = document.getElementById(`item-${checkId}`);
            const completedBadge = document.getElementById(`completed-${checkId}`);
            
            if (checkbox.checked) {
                const completedDate = new Date();
                item.classList.add('completed');
                item.classList.remove('overdue');
                completedBadge.textContent = `Completed: ${completedDate.toLocaleDateString()}`;
                completedBadge.style.display = 'inline-block';
                
                // Save completion date
                const progress = JSON.parse(localStorage.getItem('fellowshipProgress') || '{}');
                progress[checkId] = {
                    completed: true,
                    completedDate: completedDate.toISOString()
                };
                localStorage.setItem('fellowshipProgress', JSON.stringify(progress));
            } else {
                item.classList.remove('completed');
                completedBadge.style.display = 'none';
                
                // Remove from storage
                const progress = JSON.parse(localStorage.getItem('fellowshipProgress') || '{}');
                delete progress[checkId];
                localStorage.setItem('fellowshipProgress', JSON.stringify(progress));
            }
            
            updateAllStats();
        }

        function loadProgress() {
            const saved = localStorage.getItem('fellowshipProgress');
            if (saved) {
                const progress = JSON.parse(saved);
                Object.keys(progress).forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.checked = progress[id].completed;
                        const item = document.getElementById(`item-${id}`);
                        const completedBadge = document.getElementById(`completed-${id}`);
                        if (progress[id].completed) {
                            item.classList.add('completed');
                            item.classList.remove('overdue');
                            const completedDate = new Date(progress[id].completedDate);
                            completedBadge.textContent = `Completed: ${completedDate.toLocaleDateString()}`;
                            completedBadge.style.display = 'inline-block';
                        }
                    }
                });
            }
            updateAllStats();
        }

        function updateAllStats() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const checked = document.querySelectorAll('input[type="checkbox"]:checked').length;
            const total = checkboxes.length;
            const percentage = Math.round((checked / total) * 100);
            
            document.getElementById('completedTasks').textContent = `${checked}/${total}`;
            document.getElementById('progressPercent').textContent = `${percentage}%`;
            document.getElementById('overallProgress').style.width = `${percentage}%`;
            document.getElementById('overallProgress').textContent = `${percentage}%`;
            
            // Calculate schedule variance
            const expectedProgress = getExpectedProgress();
            const variance = percentage - expectedProgress;
            const varianceCard = document.getElementById('varianceCard');
            
            if (variance > 5) {
                document.getElementById('scheduleVariance').textContent = `${Math.round(variance)}% Ahead`;
                varianceCard.classList.add('ahead');
                varianceCard.classList.remove('behind');
            } else if (variance < -5) {
                document.getElementById('scheduleVariance').textContent = `${Math.abs(Math.round(variance))}% Behind`;
                varianceCard.classList.add('behind');
                varianceCard.classList.remove('ahead');
            } else {
                document.getElementById('scheduleVariance').textContent = 'On Track';
                varianceCard.classList.remove('ahead', 'behind');
            }
            
            // Update days elapsed
            document.getElementById('daysElapsed').textContent = getDaysElapsed();
            
            // Update phase progress
            roadmapData.phases.forEach((phase, phaseIdx) => {
                const phaseChecks = document.querySelectorAll(`input[id^="check-${phaseIdx}-"]:checked`).length;
                const phaseTotal = getTotalTasks(phase);
                const elem = document.getElementById(`phase-progress-${phaseIdx}`);
                if (elem) {
                    elem.textContent = `${phaseChecks}/${phaseTotal} completed`;
                }
            });
            
            updateDashboard();
            updateCalendar();
            updateTimeline();
            updateAnalytics();
        }

        function updateDashboard() {
            // Phase completion bars
            let phaseHTML = '';
            roadmapData.phases.forEach((phase, idx) => {
                const phaseChecks = document.querySelectorAll(`input[id^="check-${idx}-"]:checked`).length;
                const phaseTotal = getTotalTasks(phase);
                const phasePercent = Math.round((phaseChecks / phaseTotal) * 100);
                
                phaseHTML += `
                    <div style="margin: 10px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${phase.name}</span>
                            <span>${phasePercent}%</span>
                        </div>
                        <div class="progress-bar" style="height: 20px;">
                            <div class="progress-fill" style="width: ${phasePercent}%; background: ${phase.color};">${phasePercent}%</div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('phaseProgress').innerHTML = phaseHTML;
            
            // Recent completions
            const progress = JSON.parse(localStorage.getItem('fellowshipProgress') || '{}');
            const completions = Object.entries(progress)
                .filter(([id, data]) => data.completed)
                .sort((a, b) => new Date(b[1].completedDate) - new Date(a[1].completedDate))
                .slice(0, 5);
            
            let recentHTML = '<ul style="list-style: none; padding: 0;">';
            if (completions.length === 0) {
                recentHTML += '<li style="color: #999;">No tasks completed yet</li>';
            } else {
                completions.forEach(([id, data]) => {
                    const date = new Date(data.completedDate);
                    recentHTML += `<li style="padding: 5px 0; border-bottom: 1px solid #eee;">
                        ‚úì Completed ${date.toLocaleDateString()}
                    </li>`;
                });
            }
            recentHTML += '</ul>';
            document.getElementById('recentCompletions').innerHTML = recentHTML;
        }

        function updateCalendar() {
            const container = document.getElementById('calendarView');
            let html = '';
            
            roadmapData.phases.forEach(phase => {
                phase.months.forEach((monthData, monthIdx) => {
                    html += `<div class="calendar-month">`;
                    html += `<h3>${monthData.month}</h3>`;
                    html += `<div class="calendar-tasks">`;
                    
                    monthData.tasks.forEach((task, taskIdx) => {
                        const phaseIdx = roadmapData.phases.indexOf(phase);
                        const checkId = `check-${phaseIdx}-${monthIdx}-${taskIdx}`;
                        const checkbox = document.getElementById(checkId);
                        const isCompleted = checkbox && checkbox.checked;
                        const icon = isCompleted ? '‚úÖ' : '‚¨ú';
                        
                        html += `<div class="calendar-task">
                            <span>${icon}</span>
                            <span style="font-size: 0.85em;">${task.text.substring(0, 40)}${task.text.length > 40 ? '...' : ''}</span>
                        </div>`;
                    });
                    
                    html += `</div></div>`;
                });
            });
            
            container.innerHTML = html;
        }

        function updateTimeline() {
            const container = document.getElementById('timelineContainer');
            let html = '';
            
            const progress = JSON.parse(localStorage.getItem('fellowshipProgress') || '{}');
            const completions = Object.entries(progress)
                .filter(([id, data]) => data.completed)
                .sort((a, b) => new Date(b[1].completedDate) - new Date(a[1].completedDate));
            
            if (completions.length === 0) {
                html = '<p style="text-align: center; color: #999; padding: 20px;">No completions yet. Start checking off tasks!</p>';
            } else {
                completions.forEach(([id, data]) => {
                    const date = new Date(data.completedDate);
                    const taskLabel = document.querySelector(`label[for="${id}"]`);
                    const taskText = taskLabel ? taskLabel.textContent : 'Task';
                    
                    html += `<div class="timeline-item">
                        <div class="timeline-date">${date.toLocaleDateString()}</div>
                        <div>‚úì ${taskText}</div>
                    </div>`;
                });
            }
            
            container.innerHTML = html;
        }

        function updateAnalytics() {
            const container = document.getElementById('analyticsContent');
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const checked = document.querySelectorAll('input[type="checkbox"]:checked').length;
            const total = checkboxes.length;
            const percentage = Math.round((checked / total) * 100);
            const expectedProgress = getExpectedProgress();
            const variance = percentage - expectedProgress;
            
            let html = `
                <div class="chart-container">
                    <h3>Performance Metrics</h3>
                    <div class="analytics-grid">
                        <div class="stat-card">
                            <h3>${percentage}%</h3>
                            <p>Actual Progress</p>
                        </div>
                        <div class="stat-card">
                            <h3>${Math.round(expectedProgress)}%</h3>
                            <p>Expected Progress</p>
                        </div>
                        <div class="stat-card ${variance > 0 ? 'ahead' : variance < 0 ? 'behind' : ''}">
                            <h3>${variance > 0 ? '+' : ''}${Math.round(variance)}%</h3>
                            <p>Variance</p>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>Completion Rate Analysis</h3>
                    <p>Based on your current progress, you are ${variance > 0 ? 'ahead of' : variance < 0 ? 'behind' : 'on track with'} schedule.</p>
                    ${variance < -10 ? '<p style="color: #f44336; font-weight: bold;">‚ö†Ô∏è Consider increasing study time to get back on track.</p>' : ''}
                    ${variance > 10 ? '<p style="color: #4CAF50; font-weight: bold;">üéâ Excellent progress! Keep up the momentum.</p>' : ''}
                </div>
            `;
            
            container.innerHTML = html;
        }

        function exportProgress() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const checked = document.querySelectorAll('input[type="checkbox"]:checked').length;
            const total = checkboxes.length;
            const percentage = Math.round((checked / total) * 100);
            const progress = JSON.parse(localStorage.getItem('fellowshipProgress') || '{}');
            
            let exportText = `Fellowship Progress Report - Enhanced\n`;
            exportText += `Generated: ${new Date().toLocaleString()}\n`;
            exportText += `Overall Progress: ${checked}/${total} tasks (${percentage}%)\n`;
            exportText += `Days Elapsed: ${getDaysElapsed()}\n`;
            exportText += `Expected Progress: ${Math.round(getExpectedProgress())}%\n\n`;
            
            roadmapData.phases.forEach((phase, phaseIdx) => {
                const phaseChecks = document.querySelectorAll(`input[id^="check-${phaseIdx}-"]:checked`).length;
                const phaseTotal = getTotalTasks(phase);
                exportText += `\n${phase.name}: ${phaseChecks}/${phaseTotal} completed\n`;
                exportText += `${'='.repeat(60)}\n`;
                
                phase.months.forEach((monthData, monthIdx) => {
                    exportText += `\n${monthData.month}\n`;
                    monthData.tasks.forEach((task, taskIdx) => {
                        const checkId = `check-${phaseIdx}-${monthIdx}-${taskIdx}`;
                        const taskProgress = progress[checkId];
                        const status = taskProgress ? '‚úì' : '‚òê';
                        const completedDate = taskProgress ? ` [Completed: ${new Date(taskProgress.completedDate).toLocaleDateString()}]` : '';
                        const dueDate = ` [Due: ${task.dueDate.toLocaleDateString()}]`;
                        exportText += `  ${status} ${task.text}${dueDate}${completedDate}\n`;
                    });
                });
            });
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fellowship-progress-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }

        // Initialize
        window.onload = function() {
            updateCurrentDate();
            generateChecklist();
            updateAllStats();
            
            // Update date every minute
            setInterval(updateCurrentDate, 60000);
        };
    </script>
</body>
</html>